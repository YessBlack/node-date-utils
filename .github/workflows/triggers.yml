name: triggers practice
on: issue_comment

jobs:
  pr_commented:
    name: PR comment
    if: ${{ github.event.issue.pull_request }}
    runs-on: ubuntu-latest
    steps:
      - run: |
          echo A comment on PR $NUMBER
        env:
          NUMBER: ${{ github.event.issue.number }}

  show-secrets:
    name: Show secrets
    runs-on: ubuntu-latest
    steps:
      - name: Check secret presence
        run: |
          if [ -z "${{ secrets.API_KEY }}" ]; then
            echo ":x: No existe el secreto API_KEY"
          else
            echo ":marca_de_verificación_blanca: El secreto API_KEY está presente"
          fi

  notify-slack:
    name: Send Slack notification
    runs-on: ubuntu-latest
    steps:
      - name: Send message to Slack
        run: |
          if [ -z "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
            echo ":x: No existe el secreto SLACK_WEBHOOK_URL"
            exit 1
          fi
      - name: Send Slack Notification
        run: |
          PR_NUMBER=${{ github.event.issue.number }}
          PR_TITLE=${{ github.event.issue.title }}
          PR_URL=${{ github.event.issue.html_url }}
          AUTHOR=${{ github.event.issue.user.login }}
          # Mensaje formateado para Slack
          MESSAGE=":gorro_de_fiesta: *Nuevo PR abierto/actualizado por* *${AUTHOR}* \n>*#${PR_NUMBER}* - ${PR_TITLE}\n${PR_URL}"
          # Enviar a Slack
          curl -X POST -H 'Content-type: application/json' \
            --data "{\"text\":\"$MESSAGE\"}" \
            ${{ secrets.SLACK_WEBHOOK_URL }}